#!/bin/bash

if [[ $# -eq 2 ]]; then
    img=$1
    mnt=$2
else
    echo "clear-uefi <img> <mnt-point>" >&2
    exit 1
fi

if [[ ! -f $img ]]; then
    echo "Missing <img> file ($img)" >&2
    exit 1
fi

if [[ ! -d $mnt ]]; then
    echo "Missing <mnt> directory ($mnt)" >&2
    exit 1
fi


sudo losetup --offset 1048576 /dev/loop0 $img
sudo mount /dev/loop0 $mnt

echo -n "About to [sudo rm -rf $mnt/*].  Are you sure? [Y to confirm] "
read ans

if [[ $ans == "Y" || $ans == "y" ]]; then
    sudo rm -rf $mnt/*
else
    echo "Aborting."
fi

sudo umount $mnt
sudo losetup -d /dev/loop0

echo "Done."
